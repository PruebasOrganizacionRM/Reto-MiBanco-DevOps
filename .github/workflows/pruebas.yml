name: Pruebas usando variables
run-name: Â¡Estoy probando variables a usar Variables!
on:
  workflow_dispatch:
    inputs:
      username:
        description: "GitHub username a invitar (sin @)"
        required: true
        type: string
      team:
        description: "Nombre del team en la organizaciÃ³n"
        required: true
        type: string
      repo:
        description: "Repositorio destino para asignar permisos (nombre)"
        required: true
        type: string
      permission:
        description: "Permiso en repo: pull, triage, push, maintain, admin"
        required: true
        default: "push"
        type: string

jobs:
  onboarding:
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: read
      issues: write
    steps:
     - name: Auth gh con token
       env:
          GH_TOKEN1: ${{ secrets.GH_TOKEN }}
       run: |
          echo "$GH_TOKEN1" | gh auth login --with-token
     
     - name: Agregar usuario al equipo
       env:
          ORG: ${{ inputs.team }}
          USER: ${{ inputs.username }}
       run: |
          

          echo "ðŸ”Ž Obteniendo todos los equipos de la organizaciÃ³n: $ORG..."

          # Obtener nombres y slugs en arrays
          mapfile -t TEAM_NAMES < <(gh api /orgs/$ORG/teams --jq '.[].name')
          mapfile -t TEAM_SLUGS < <(gh api /orgs/$ORG/teams --jq '.[].slug')
          
          echo "âœ… Equipos encontrados:"
          for i in "${!TEAM_NAMES[@]}"; do
            echo " - ${TEAM_NAMES[$i]} (slug: ${TEAM_SLUGS[$i]})"
          done
          
          echo ""
          echo "ðŸ‘¤ Preparando para agregar al usuario $USER en cada equipo..."
          
          # Recorremos todos los equipos y agregamos al usuario
          for i in "${!TEAM_SLUGS[@]}"; do
            TEAM_NAME=${TEAM_NAMES[$i]}
            TEAM_SLUG=${TEAM_SLUGS[$i]}
          
            echo "âž¡ï¸  Agregando $USER al equipo $TEAM_NAME ($TEAM_SLUG)..."
            gh api --method PUT /orgs/$ORG/teams/$TEAM_SLUG/memberships/$USER -f role=member || true
          done
          
          echo "ðŸŽ‰ Proceso terminado"
               
      
